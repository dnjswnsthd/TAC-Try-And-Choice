<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.service.tac.model.mapper.CardMapper">
	<resultMap type="Card" id="card">
		<id column="card_id" property="cardId" />
		<result column="card_name" property="cardName" />
		<result column="card_desc" property="cardDesc" />
		<result column="card_img" property="cardImg" />
		<result column="max_discount" property="maxDiscount" />
	</resultMap>
	
	<insert id="insertC" parameterType="card">
		<selectKey keyProperty="cardId" resultType="int" order="BEFORE">
			SELECT card_seq.nextVal FROM dual
		</selectKey>
			INSERT INTO card(card_id, card_name, card_desc, card_img, max_discount)
			VALUES (#{cardId}, #{cardName}, #{cardDesc}, 'IMG', #{maxDiscount})
	</insert>
  
	<resultMap type="cardDetail" id="cardDetailWithCategory">
		<id column="card_detail_id" property="cardDetailId" />
		<result column="discount_percent" property="discountPercent" />
		<result column="card_id" property="cardId" />
		<result column="large_category_id" property="largeCategoryId" />
		<result column="small_category_id" property="smallCategoryId" />
		<result column="min_payment" property="minPayment" />
		<result column="max_discount" property="maxDiscount" />
		<result column="max_count" property="mixCount" />
		<association property="smallCategory" javaType="smallCategory">
			<id column="small_category_id" property="smallCategoryId" />
			<result column="small_category_name" property="smallCategoryName" />
			<result column="large_category_id" property="largeCategoryId" />
		</association>
		
	</resultMap>

	<!-- Card 전체 정보 Select -->
	<select id="getAllCardInfo" resultMap ="card">
		select card_id, card_name, card_desc, card_img, max_discount
		from card
	</select>
	
	<select id="getDiscountInfoByCard" parameterType="int" resultMap="cardDetailWithCategory">
		SELECT s.small_category_name, c.discount_percent, c.discount_amount
		FROM  card_detail  c
		JOIN small_category  s
		ON (s.small_category_id = c.small_category_id)
		WHERE c.card_id=#{VALUE}
	</select>
	
	<select id="getCardInfo" parameterType="int" resultMap="card">
		SELECT card_id, card_name, card_desc, card_img  
		FROM card
		WHERE card_id=#{VALUE}
	</select>
	

</mapper>